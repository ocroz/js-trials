<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>JIRA Custom Issue Collector</title>

  <link rel="stylesheet" href="/custom/lib/bootstrap/3.3.7/css/bootstrap.min.css">
  <!-- Bootstrap's JavaScript requires jQuery version 1.9.1 or higher, but lower than version 4 -->
  <script src="/custom/lib/jquery/3.2.1/jquery.min.js"></script>
  <script src="/custom/lib/bootstrap/3.3.7/js/bootstrap.min.js"></script>

  <link rel="stylesheet" href="/custom/jcic/1/css/jcic.css">
</head>
<body>

<button class="btn btn-default" onclick="showIframe()">Show dialog</button>

<div id="createBasicDialog" class="modal fade jcic-dialog" role="dialog" style="height:233px; width:700px;">
  <div class="modal-content jcic-dialog-content">
    <iframe id="createBasicFrm" class="jcic-dialog-iframe" src="about:blank"></iframe>
  </div>
</div>

<script type="text/javascript">
  /* globals $ fetch */
  /* eslint-disable no-unused-vars */
  async function showIframe () {
    // https://atlassian.hq.k.grp/confluence/download/attachments/117431171/basichtml.json
    var content
    var html = await fetch('/custom/jcic/1/examples/parent2iframe-writejson.json')
      .then(resp => resp.text())
      .then(text => { content = text; return JSON.parse(text) })
      .catch(err => {
        console.error(err.message)
        var mess = err.message.split(' ')
        var pos = Number(mess[mess.length - 1])
        console.error('around:\n', content.substring(pos > 50 ? pos - 50 : 0, pos + 50))
      })
      .then(json => json.body.join(''))

    var d = $('#createBasicFrm')[0].contentWindow.document; d.open(); d.write(html); d.close()
  }
</script>

</body>
</html>
